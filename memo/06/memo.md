### I/Oポート

外部デバイス入出力の口

アプリケーションがI/Oポートにアクセスする方法

- 専用のアドレス空間を通じて
- memory mapped I/O

#### IOPL I/O Privilege Level

実行中のプログラム入出力命令を実行するのに必要な特権レベルを定める
OS はIOPLをプログラム/タスクごとに設定できる

Intel 64では `I/O許可ビットマップ`を介して
もっと細かいパーミッションの制御が可能。

手続きとしては
1. IOPLをチェック
2. パスしなかった場合にプロセッサがポートに対応するビットをチェック
   ビットがクリアされていれば命令の処理が実行される

### 割り込み

プログラムの制御の流れを任意のタイミングで即座に入れ替える
CPUは IDT (Interrupt Descriptor Table) を参照する
そのアドレスとサイズは`idtr`に保存される

64bit分がオフセットで確保されるから本の図のインデックスは`79`になっている

### DPL

Descriptor Privilege Level

int 命令を行う特権コードの制御を行うためのもの

### システムコール

CPU <-> OS <-> アプリケーション

システムコールは OSとアプリケーションをつなぐ役目を持つ

### モデル固有レジスタ MSR Model-Specific Register

新しいCPUに積まれた新しいレジスタのこと
それらを総称してMSRと呼ぶ
こららの一般的なレジスタを書き換えるときは 下記を使う

- rdmsr
    - 読み出し
    - MSR番号をecxで受け取り、そのレジスタから読んだ値をedx:eaxで返す
- wrmsr
    - 書き出し
    - MSR番号をecxで受け取り、edx:eaxから取り出した値をそのレジスタに書く

Todo なぜsyscallはMSRに依存するのか